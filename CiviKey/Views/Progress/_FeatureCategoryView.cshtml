@model ICollection<CiviKey.ViewModel.FeatureViewModel>
@{
    int lineCount = (int)Math.Ceiling( (double)Model.Count / (double)4 );
    int visibleLinesCount = lineCount;
    if( lineCount > 2 )
    {
        visibleLinesCount = 2;
    }
    int lineFeatureCount = Model.Count > 3 ? 3 : Model.Count;
    int index;
    bool hasExtraFeatures = false;
}
@for( index = 0; index < lineCount; index++ )
    {
        if( Model.Count - index * lineFeatureCount < lineFeatureCount )
        {
            lineFeatureCount = Model.Count - index * lineFeatureCount;
        }
        <div class="progress-list-line @if( index >= visibleLinesCount )
                                       {
                                           hasExtraFeatures = true; @("hidden-feature")}">
            @for( int j = 3 * index; j < ( 3 * index + lineFeatureCount ); j++ )
            {
                <div class="progress-list-elem @if( ( j + 1 ) % 3 == 0 )
                                               {@("last-feature")}" data-id="@Model.ElementAt(j).Id">
                    @Html.Partial( "_FeatureView", Model.ElementAt(j) )
                </div>
            }
            <div style="clear: both;">
            </div>
        </div>
    }
    @if( hasExtraFeatures )
    {
        <div class="show-more-features">
            show more</div>
    }