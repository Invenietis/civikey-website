@model IList<CiviKey.ViewModel.FeatureViewModel>
@section js{
    <script src="@Url.Content( "~/Scripts/progress.js" )" type="text/javascript"></script>
}
@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_Layout.cshtml";
    int lineCount = (int)Math.Ceiling( (double)Model.Count / (double)4 );
    int visibleLinesCount = lineCount;
    if( lineCount > 2 )
    {
        visibleLinesCount = 2;
    }
    int lineFeatureCount = Model.Count > 4 ? 4 : Model.Count;
    int index;
    bool hasExtraFeatures = false;
}
<div class="progress-content">
    <div class="progress-timebar">
        <div class="progress-timebar-container">
            <div class="progress-bar-begin">
            </div>
            <ul id="timeline-buttons">
                <li><a href="@Url.Action( "Index", "Progress", new { id = 0 })" class="@if( ViewBag.CurrentRoadmapId == null || ViewBag.CurrentRoadmapId == 0)
                                                                                                   {@("timeline-selected")}
                                                                                                   else
                                                                                                   {@("timeline-unselected")}">Existant</a></li>   @*@Url.RouteUrl( "Default", new { controller = "Progress", action = "Index" }*@
                @foreach( CiviKey.Models.tRoadMap item in ViewBag.Roadmaps )
                {
                    <li><a href="@Url.Action( "Index", "Progress", new { id = @item.Id } )" class="@if( ViewBag.CurrentRoadmapId == item.Id )
                                                                                                   {@("timeline-selected")}
                                                                                                   else if( ViewBag.CurrentRoadmapId != null || ViewBag.CurrentRoadmapId != 0 )
                                                                                                   {@("timeline-unselected")}">@item.Name</a></li> 
                }
            </ul>
        </div>
        <div class="progress-bar-end">
        </div>
        <div style="clear: both;">
        </div>
    </div>
    <div class="progress-list-of-features">
        @for( index = 0; index < lineCount; index++ )
        {
            if( Model.Count - index * lineFeatureCount < lineFeatureCount )
            {
                lineFeatureCount = Model.Count - index * lineFeatureCount;
            }
            <div class="progress-list-line @if( index >= visibleLinesCount )
                                           {
                                               hasExtraFeatures = true; @("hidden-feature")}">
                @for( int j = 4 * index; j < ( 4 * index + lineFeatureCount ); j++ )
                {
                    <div class="progress-list-elem @if( ( j + 1 ) % 4 == 0 )
                                                   {@("last-feature")}" onclick="location.href='@Url.Action( "Index", "Feature", new { id = @Model[j].Id } )'">
                        @Html.Partial( "_FeatureDisplay", Model[j] )
                    </div>
                }
                
                    <div style="clear: both;">
                    </div>
            </div>
        }
        @if( hasExtraFeatures )
        {
        <div class="show-more-features">
            show more</div>
        }
    </div>
</div>
